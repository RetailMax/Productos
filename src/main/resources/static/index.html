<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailMax - Productos</title>
    <link rel="icon" href="retailmax.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --navbar-height: 128px;
            --verde-retailmax: #22c55e;
            --rojo-inactivo: #ef4444;
        }
        .product-card img {
            object-fit: cover;
            height: 200px;
            width: 100%;
        }
        .category-badge {
            font-size: 0.9em;
            margin-bottom: 0.5em;
        }
        /* Sticky aside compensando navbar */
        .filtros-sticky {
            position: sticky;
            top: var(--navbar-height);
        }
        /* Colores verdes personalizados */
        .bg-verde-retailmax {
            background-color: var(--verde-retailmax) !important;
            color: #fff !important;
        }
        .btn-verde-retailmax {
            background-color: var(--verde-retailmax) !important;
            border-color: var(--verde-retailmax) !important;
            color: #fff !important;
        }
        .btn-verde-retailmax:hover, .btn-verde-retailmax:focus {
            background-color: #16a34a !important;
            border-color: #16a34a !important;
            color: #fff !important;
        }
        .badge-verde-retailmax {
            background-color: var(--verde-retailmax) !important;
            color: #fff !important;
        }
        .badge-inactivo {
            background-color: var(--rojo-inactivo) !important;
            color: #fff !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4 shadow-sm sticky-top" style="z-index: 1030;">
      <div class="container-fluid ps-md-4 ps-3">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="retailmax.png" alt="RetailMax" width="80" height="80" class="me-2" style="object-fit:contain;">
          <span class="fw-bold">RetailMax</span>
        </a>
        <div class="navbar-nav ms-auto me-3">
          <button id="apiTesterBtn" class="btn btn-outline-primary">
            <i class="bi bi-code-slash me-1"></i>API Tester
          </button>
        </div>
      </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <!-- ASIDE FILTROS -->
            <aside class="col-md-3 col-lg-2 mb-4">
                <div class="filtros-sticky">
                    <div class="card shadow-sm">
                        <div class="card-header bg-verde-retailmax">
                            <i class="bi bi-funnel"></i> Filtros
                        </div>
                        <div class="card-body">
                            <form id="filtrosForm" class="row g-3 align-items-end">
                                <div class="col-12">
                                    <label for="filtroCategoria" class="form-label mb-0">Categoría</label>
                                    <select id="filtroCategoria" class="form-select">
                                        <option value="">Todas</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label for="filtroBusqueda" class="form-label mb-0">Buscar</label>
                                    <input type="search" id="filtroBusqueda" class="form-control" placeholder="Nombre o descripción">
                                </div>
                                <div class="col-12">
                                    <label for="filtroOrden" class="form-label mb-0">Ordenar por</label>
                                    <select id="filtroOrden" class="form-select">
                                        <option value="">Por defecto</option>
                                        <option value="name,asc">Nombre (A-Z)</option>
                                        <option value="name,desc">Nombre (Z-A)</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label mb-0">Estado</label>
                                    <select id="filtroEstado" class="form-select">
                                        <option value="todos" selected>Todos</option>
                                        <option value="activos">Activos</option>
                                        <option value="inactivos">Inactivos</option>
                                    </select>
                                </div>
                                <div class="col-12 d-flex gap-2">
                                    <button type="submit" class="btn btn-verde-retailmax flex-fill"><i class="bi bi-funnel"></i> Aplicar</button>
                                    <button type="button" id="btnResetFiltros" class="btn btn-outline-secondary flex-fill"><i class="bi bi-arrow-counterclockwise"></i> Restablecer</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </aside>
            <!-- CONTENIDO PRINCIPAL -->
            <main class="col-md-9 col-lg-10">
                <div class="py-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1 class="h3">Catálogo de Productos</h1>
                        <div>
                            <button id="addCategoriaBtn" class="btn btn-verde-retailmax me-2">
                                <i class="bi bi-tags-fill me-1"></i>Agregar categoría
                            </button>
                            <button id="addProductoBtn" class="btn btn-warning me-2">
                                <i class="bi bi-box-seam me-1"></i>Agregar producto
                            </button>
                            <button id="batchBtn" class="btn btn-info">
                                <i class="bi bi-upload me-1"></i>Carga batch
                            </button>
                        </div>
                    </div>
                    <!-- Sección de categorías -->
                    <h2 class="h5 mb-3">Categorías</h2>
                    <div id="categoriasRow" class="row g-3 mb-4">
                        <!-- Aquí se insertarán las cards de categorías -->
                    </div>
                    <!-- Modal Agregar Categoría -->
                    <div class="modal fade" id="modalCategoria" tabindex="-1" aria-labelledby="modalCategoriaLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalCategoriaLabel">Agregar nueva categoría</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                          </div>
                          <form id="formCategoria">
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="catName" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="catName" required maxlength="100">
                              </div>
                              <div class="mb-3">
                                <label for="catDesc" class="form-label">Descripción</label>
                                <input type="text" class="form-control" id="catDesc" required maxlength="500">
                              </div>
                              <div class="mb-3">
                                <label for="catImg" class="form-label">URL de imagen (opcional)</label>
                                <input type="url" class="form-control" id="catImg" maxlength="500">
                              </div>
                              <div id="catMsg" class="alert d-none" role="alert"></div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                              <button type="submit" class="btn btn-success">Agregar</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- Modal Agregar Producto -->
                    <div class="modal fade" id="modalProducto" tabindex="-1" aria-labelledby="modalProductoLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalProductoLabel">Agregar nuevo producto</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                          </div>
                          <form id="formProducto">
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="prodName" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="prodName" required maxlength="100">
                              </div>
                              <div class="mb-3">
                                <label for="prodDesc" class="form-label">Descripción</label>
                                <input type="text" class="form-control" id="prodDesc" required maxlength="500">
                              </div>
                              <div class="mb-3">
                                <label for="prodBrand" class="form-label">Marca</label>
                                <input type="text" class="form-control" id="prodBrand" required maxlength="50">
                              </div>
                              <div class="mb-3">
                                <label for="prodPrice" class="form-label">Precio</label>
                                <input type="number" class="form-control" id="prodPrice" required min="0">
                              </div>
                              <div class="mb-3">
                                <label for="prodCat" class="form-label">Categoría</label>
                                <select class="form-select" id="prodCat" required></select>
                              </div>
                              <div class="mb-3">
                                <label for="prodImg" class="form-label">URL de imagen (opcional)</label>
                                <input type="url" class="form-control" id="prodImg" maxlength="500">
                              </div>
                              <div id="prodMsg" class="alert d-none" role="alert"></div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                              <button type="submit" class="btn btn-warning">Agregar</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- Modal Carga Batch -->
                    <div class="modal fade" id="modalBatch" tabindex="-1" aria-labelledby="modalBatchLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalBatchLabel">Carga batch de productos</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                          </div>
                          <form id="formBatch">
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="batchJson" class="form-label">Pega aquí el JSON (array de productos)</label>
                                <textarea class="form-control" id="batchJson" rows="8" required placeholder='[
  { "name": "...", ... },
  ...
]'></textarea>
                              </div>
                              <div id="batchMsg" class="alert d-none" role="alert"></div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                              <button type="submit" class="btn btn-info">Cargar</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- Modal API Tester -->
                    <div class="modal fade" id="modalApiTester" tabindex="-1" aria-labelledby="modalApiTesterLabel" aria-hidden="true">
                      <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalApiTesterLabel">
                              <i class="bi bi-code-slash me-2"></i>API Tester - Simulando Postman
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                          </div>
                          <div class="modal-body">
                            <div class="row">
                              <!-- COLUMNA 1 - CATEGORÍAS -->
                              <div class="col-md-6">
                                <h6 class="mb-3"><i class="bi bi-tags me-2"></i>Endpoints de Categorías</h6>
                                
                                <!-- GET /api/categories -->
                                <div class="card mb-3">
                                  <div class="card-header bg-primary text-white">
                                    <i class="bi bi-list me-2"></i>GET /api/categories
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="categoriesStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <button id="testCategoriesBtn" class="btn btn-sm btn-primary mb-2">
                                      <i class="bi bi-play me-1"></i>Probar Endpoint
                                    </button>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="categoriesResponse" class="mb-0" style="font-size: 0.8em;">Haz clic en "Probar Endpoint" para ver la respuesta...</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/categories/{id} -->
                                <div class="card mb-3">
                                  <div class="card-header bg-primary text-white">
                                    <i class="bi bi-search me-2"></i>GET /api/categories/{id}
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="categoryByIdStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="number" id="categoryIdInput" class="form-control form-control-sm" placeholder="ID de categoría" value="1">
                                      <button id="testCategoryByIdBtn" class="btn btn-sm btn-primary">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="categoryByIdResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un ID y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/categories/search -->
                                <div class="card mb-3">
                                  <div class="card-header bg-primary text-white">
                                    <i class="bi bi-search me-2"></i>GET /api/categories/search
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="categorySearchStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="text" id="categorySearchInput" class="form-control form-control-sm" placeholder="Término de búsqueda" value="tecnología">
                                      <button id="testCategorySearchBtn" class="btn btn-sm btn-primary">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="categorySearchResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un término y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/categories/exists -->
                                <div class="card mb-3">
                                  <div class="card-header bg-primary text-white">
                                    <i class="bi bi-check-circle me-2"></i>GET /api/categories/exists
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="categoryExistsStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="text" id="categoryExistsInput" class="form-control form-control-sm" placeholder="Nombre de categoría" value="Tecnología">
                                      <button id="testCategoryExistsBtn" class="btn btn-sm btn-primary">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="categoryExistsResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un nombre y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- COLUMNA 2 - PRODUCTOS -->
                              <div class="col-md-6">
                                <h6 class="mb-3"><i class="bi bi-box-seam me-2"></i>Endpoints de Productos</h6>
                                
                                <!-- GET /api/products -->
                                <div class="card mb-3">
                                  <div class="card-header bg-success text-white">
                                    <i class="bi bi-list me-2"></i>GET /api/products
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="productsStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <button id="testProductsBtn" class="btn btn-sm btn-success mb-2">
                                      <i class="bi bi-play me-1"></i>Probar Endpoint
                                    </button>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="productsResponse" class="mb-0" style="font-size: 0.8em;">Haz clic en "Probar Endpoint" para ver la respuesta...</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/products/{id} -->
                                <div class="card mb-3">
                                  <div class="card-header bg-success text-white">
                                    <i class="bi bi-search me-2"></i>GET /api/products/{id}
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="productByIdStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="number" id="productIdInput" class="form-control form-control-sm" placeholder="ID de producto" value="1">
                                      <button id="testProductByIdBtn" class="btn btn-sm btn-success">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="productByIdResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un ID y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/products/search -->
                                <div class="card mb-3">
                                  <div class="card-header bg-success text-white">
                                    <i class="bi bi-search me-2"></i>GET /api/products/search
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="productSearchStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="text" id="productSearchInput" class="form-control form-control-sm" placeholder="Término de búsqueda" value="laptop">
                                      <button id="testProductSearchBtn" class="btn btn-sm btn-success">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="productSearchResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un término y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/products/inactivos -->
                                <div class="card mb-3">
                                  <div class="card-header bg-warning text-dark">
                                    <i class="bi bi-x-circle me-2"></i>GET /api/products/inactivos
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="productsInactivosStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <button id="testProductsInactivosBtn" class="btn btn-sm btn-warning mb-2">
                                      <i class="bi bi-play me-1"></i>Probar Endpoint
                                    </button>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="productsInactivosResponse" class="mb-0" style="font-size: 0.8em;">Haz clic en "Probar Endpoint" para ver la respuesta...</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/products/count-by-categoria -->
                                <div class="card mb-3">
                                  <div class="card-header bg-info text-white">
                                    <i class="bi bi-bar-chart me-2"></i>GET /api/products/count-by-categoria
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="countStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <button id="testCountBtn" class="btn btn-sm btn-info mb-2">
                                      <i class="bi bi-play me-1"></i>Probar Endpoint
                                    </button>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="countResponse" class="mb-0" style="font-size: 0.8em;">Haz clic en "Probar Endpoint" para ver la respuesta...</pre>
                                    </div>
                                  </div>
                                </div>

                                <!-- GET /api/products/exists -->
                                <div class="card mb-3">
                                  <div class="card-header bg-success text-white">
                                    <i class="bi bi-check-circle me-2"></i>GET /api/products/exists
                                  </div>
                                  <div class="card-body">
                                    <div class="mb-2">
                                      <small class="text-muted">Status: <span id="productExistsStatus" class="badge bg-secondary">Pendiente</span></small>
                                    </div>
                                    <div class="input-group mb-2">
                                      <input type="text" id="productExistsInput" class="form-control form-control-sm" placeholder="Nombre de producto" value="Laptop">
                                      <button id="testProductExistsBtn" class="btn btn-sm btn-success">
                                        <i class="bi bi-play me-1"></i>Probar
                                      </button>
                                    </div>
                                    <div class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                      <pre id="productExistsResponse" class="mb-0" style="font-size: 0.8em;">Ingresa un nombre y haz clic en "Probar"</pre>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="row mt-3">
                              <div class="col-12">
                                <div class="card">
                                  <div class="card-header bg-info text-white">
                                    <i class="bi bi-info-circle me-2"></i>Información de la API
                                  </div>
                                  <div class="card-body">
                                    <div class="row">
                                      <div class="col-md-6">
                                        <h6>Endpoints GET Disponibles:</h6>
                                        <ul class="list-unstyled">
                                          <li><code>GET /api/categories</code> - Listar todas las categorías</li>
                                          <li><code>GET /api/categories/{id}</code> - Obtener categoría por ID</li>
                                          <li><code>GET /api/categories/search?q=term</code> - Buscar categorías</li>
                                          <li><code>GET /api/categories/exists?name=nombre</code> - Verificar existencia</li>
                                          <li><code>GET /api/products</code> - Listar todos los productos</li>
                                          <li><code>GET /api/products/{id}</code> - Obtener producto por ID</li>
                                          <li><code>GET /api/products/search?q=term</code> - Buscar productos</li>
                                          <li><code>GET /api/products/inactivos</code> - Productos inactivos</li>
                                          <li><code>GET /api/products/count-by-categoria</code> - Contar por categoría</li>
                                          <li><code>GET /api/products/exists?name=nombre</code> - Verificar existencia</li>
                                        </ul>
                                      </div>
                                      <div class="col-md-6">
                                        <h6>Características:</h6>
                                        <ul class="list-unstyled">
                                          <li>✅ HATEOAS - Navegación dinámica</li>
                                          <li>✅ Paginación automática</li>
                                          <li>✅ Filtros por categoría</li>
                                          <li>✅ Búsqueda por nombre</li>
                                          <li>✅ Validación de datos</li>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <h2 class="h5 mb-3">Productos</h2>
                    <div id="productsRow" class="row g-4">
                        <!-- Aquí se insertarán las cards de productos -->
                    </div>
                    <div id="noProductsMsg" class="alert alert-info mt-4 d-none">No hay productos para mostrar.</div>
                    <div id="paginacionProductos" class="mt-3"></div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api';
        const DEFAULT_IMAGE = 'https://static.vecteezy.com/system/resources/previews/005/377/442/non_2x/404-error-page-icon-page-not-found-line-icon-laptop-with-warning-sign-and-error-404-trouble-internet-connection-concept-file-not-found-and-broken-page-icon-illustration-vector.jpg';
        let categorias = {};

        // Refresco global de productos y categorías
        async function refrescarTodo() {
            await cargarCategoriasYRenderizar();
            await aplicarFiltros();
        }

        // Cargar y renderizar categorías SIEMPRE
        async function cargarCategoriasYRenderizar() {
            const res = await fetch(`${API_BASE}/categories`);
            let data = await res.json();
            // Si la respuesta es HATEOAS, extrae la lista
            if (data._embedded && data._embedded.categoriaList) {
                data = data._embedded.categoriaList;
            }
            categorias = {};
            data.forEach(cat => {
                categorias[cat.categoriaId] = cat;
            });
            await renderCategorias(data);
            // También llenar el filtro de categorías
            const filtroCategoria = document.getElementById('filtroCategoria');
            if (filtroCategoria) {
                filtroCategoria.innerHTML = '<option value="">Todas</option>';
                data.forEach(cat => {
                    filtroCategoria.innerHTML += `<option value="${cat.categoriaId}">${cat.name}</option>`;
                });
            }
        }

        // Renderizar productos (requiere que categorias ya esté cargado)
        function renderProductos(productos) {
            if (!Array.isArray(productos)) {
                if (productos && productos._embedded && Array.isArray(productos._embedded.productoList)) {
                    productos = productos._embedded.productoList;
                } else {
                    productos = [];
                }
            }
            const row = document.getElementById('productsRow');
            const noMsg = document.getElementById('noProductsMsg');
            row.innerHTML = '';
            if (!productos || productos.length === 0) {
                noMsg.classList.remove('d-none');
                return;
            }
            noMsg.classList.add('d-none');
            productos.forEach(prod => {
                const cat = prod.categoria ? categorias[prod.categoria.categoriaId] : {};
                const card = document.createElement('div');
                card.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
                const precioFormateado = prod.basePrice != null ? prod.basePrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") : '0';
                card.innerHTML = `
                    <div class="card product-card h-100 shadow-sm">
                        <img src="${prod.imageUrl || DEFAULT_IMAGE}" class="card-img-top" alt="Imagen producto">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">${prod.name}</h5>
                            <p class="card-text mb-1">${prod.description || ''}</p>
                            <span class="badge bg-secondary category-badge">
                                ${cat && cat.imageUrl ? `<img src='${cat.imageUrl}' alt='cat' style='height:1.5em;width:1.5em;object-fit:cover;border-radius:50%;margin-right:0.3em;'>` : ''}
                                ${cat && cat.name ? cat.name : 'Sin categoría'}
                            </span>
                            <div class="mt-auto">
                                <div class="fw-bold">$${precioFormateado}</div>
                                <div class="text-muted small">Marca: ${prod.brand || '-'}</div>
                                <div class="small ${prod.isActive ? 'badge-verde-retailmax badge' : 'badge-inactivo badge'}">${prod.isActive ? 'Activo' : 'Inactivo'}</div>
                                <div class="d-flex justify-content-end gap-2 mt-2">
                                    <button class="btn btn-sm btn-outline-primary btn-edit-prod" data-id="${prod.productId}" title="Editar"><i class="bi bi-pencil"></i></button>
                                    <button class="btn btn-sm btn-outline-danger btn-del-prod" data-id="${prod.productId}" title="Eliminar"><i class="bi bi-trash"></i></button>
                                    <button class="btn btn-sm ${prod.isActive ? 'btn-verde-retailmax' : 'btn-outline-secondary'} btn-toggle-prod" data-id="${prod.productId}" title="${prod.isActive ? 'Desactivar' : 'Activar'}">
                                        <i class="bi ${prod.isActive ? 'bi-toggle-on' : 'bi-toggle-off'}"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                row.appendChild(card);
            });
            // Asignar eventos a los botones de editar y eliminar producto después de renderizar las cards
            row.querySelectorAll('.btn-edit-prod').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    setProdMsg('', '');
                    try {
                        const res = await fetch(`${API_BASE}/products/${id}`);
                        if (!res.ok) throw new Error('No se pudo obtener el producto');
                        const prod = await res.json();
                        document.getElementById('prodName').value = prod.name;
                        document.getElementById('prodDesc').value = prod.description;
                        document.getElementById('prodBrand').value = prod.brand;
                        document.getElementById('prodPrice').value = prod.basePrice;
                        document.getElementById('prodImg').value = prod.imageUrl || '';
                        await cargarCategoriasDropdown();
                        document.getElementById('prodCat').value = prod.categoria && prod.categoria.categoriaId ? prod.categoria.categoriaId : '';
                        document.getElementById('formProducto').setAttribute('data-edit-id', id);
                        modalProducto.show();
                    } catch (err) {
                        setProdMsg('Error: ' + err.message, 'danger');
                        modalProducto.show();
                    }
                });
            });
            row.querySelectorAll('.btn-del-prod').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    const result = await Swal.fire({
                        title: '¿Eliminar producto?',
                        text: 'Esta acción no se puede deshacer.',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, eliminar',
                        cancelButtonText: 'Cancelar',
                        reverseButtons: true
                    });
                    if (!result.isConfirmed) return;
                    try {
                        const res = await fetch(`${API_BASE}/products/${id}`, { method: 'DELETE' });
                        if (!res.ok) throw new Error('No se pudo eliminar el producto');
                        await refrescarTodo();
                        await Swal.fire('¡Eliminado!', 'El producto fue eliminado correctamente.', 'success');
                    } catch (err) {
                        await Swal.fire('Error', err.message, 'error');
                    }
                });
            });
            row.querySelectorAll('.btn-toggle-prod').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    try {
                        // Buscar el estado actual del producto
                        const resGet = await fetch(`${API_BASE}/products/${id}`);
                        if (!resGet.ok) throw new Error('No se pudo obtener el producto');
                        const prod = await resGet.json();
                        const endpoint = prod.isActive ? 'deactivate' : 'activate';
                        const res = await fetch(`${API_BASE}/products/${id}/${endpoint}`, { method: 'PUT' });
                        if (!res.ok) throw new Error('No se pudo cambiar el estado');
                        await refrescarTodo();
                    } catch (err) {
                        await Swal.fire('Error', err.message, 'error');
                    }
                });
            });
        }

        // Obtener conteo de productos por categoría
        async function obtenerConteoProductos() {
            try {
                const response = await fetch(`${API_BASE}/products/count-by-categoria`);
                const data = await response.json();
                const conteoMap = {};
                if (Array.isArray(data)) {
                    data.forEach(item => {
                        conteoMap[item[0]] = item[1]; // categoriaId -> cantidad
                    });
                }
                return conteoMap;
            } catch (error) {
                console.error('Error obteniendo conteo de productos:', error);
                return {};
            }
        }

        // Renderizar categorías con conteo de productos
        async function renderCategorias(categoriasList) {
            const row = document.getElementById('categoriasRow');
            row.innerHTML = '';
            if (!categoriasList || categoriasList.length === 0) {
                row.innerHTML = '<div class="col-12"><div class="alert alert-info">No hay categorías para mostrar.</div></div>';
                return;
            }

            // Obtener conteo de productos
            const conteoProductos = await obtenerConteoProductos();

            categoriasList.forEach(cat => {
                const cantidadProductos = conteoProductos[cat.categoriaId] || 0;
                const card = document.createElement('div');
                card.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
                card.innerHTML = `
                    <div class="card h-100 shadow-sm">
                        <img src="${cat.imageUrl || DEFAULT_IMAGE}" class="card-img-top" alt="Imagen categoría" style="object-fit:cover;height:120px;">
                        <div class="card-body">
                            <h5 class="card-title">${cat.name}</h5>
                            <p class="card-text">${cat.description || ''}</p>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="small ${cat.isActive ? 'badge-verde-retailmax badge' : 'badge-inactivo badge'}">${cat.isActive ? 'Activo' : 'Inactivo'}</div>
                                <div class="small text-muted">
                                    <i class="bi bi-box-seam me-1"></i>${cantidadProductos} productos
                                </div>
                            </div>
                            <div class="d-flex justify-content-end gap-2 mt-2">
                                <button class="btn btn-sm btn-outline-primary btn-edit-cat" data-id="${cat.categoriaId}" title="Editar"><i class="bi bi-pencil"></i></button>
                                <button class="btn btn-sm btn-outline-danger btn-del-cat" data-id="${cat.categoriaId}" title="Eliminar"><i class="bi bi-trash"></i></button>
                                <button class="btn btn-sm ${cat.isActive ? 'btn-verde-retailmax' : 'btn-outline-secondary'} btn-toggle-cat" data-id="${cat.categoriaId}" title="${cat.isActive ? 'Desactivar' : 'Activar'}">
                                    <i class="bi ${cat.isActive ? 'bi-toggle-on' : 'bi-toggle-off'}"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                row.appendChild(card);
            });
            // Asignar eventos a los botones de editar y eliminar
            row.querySelectorAll('.btn-edit-cat').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    setCatMsg('', '');
                    // Consultar la categoría por la API
                    try {
                        const res = await fetch(`${API_BASE}/categories/${id}`);
                        if (!res.ok) throw new Error('No se pudo obtener la categoría');
                        const cat = await res.json();
                        document.getElementById('catName').value = cat.name;
                        document.getElementById('catDesc').value = cat.description;
                        document.getElementById('catImg').value = cat.imageUrl || '';
                        document.getElementById('formCategoria').setAttribute('data-edit-id', id);
                        modalCategoria.show();
                    } catch (err) {
                        setCatMsg('Error: ' + err.message, 'danger');
                        modalCategoria.show();
                    }
                });
            });
            row.querySelectorAll('.btn-del-cat').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    const result = await Swal.fire({
                        title: '¿Eliminar categoría?',
                        text: 'Esta acción no se puede deshacer.',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, eliminar',
                        cancelButtonText: 'Cancelar',
                        reverseButtons: true
                    });
                    if (!result.isConfirmed) return;
                    try {
                        const res = await fetch(`${API_BASE}/categories/${id}`, { method: 'DELETE' });
                        if (!res.ok) throw new Error('No se pudo eliminar la categoría');
                        await refrescarTodo();
                        await Swal.fire('¡Eliminada!', 'La categoría fue eliminada correctamente.', 'success');
                    } catch (err) {
                        await Swal.fire('Error', err.message, 'error');
                    }
                });
            });
            row.querySelectorAll('.btn-toggle-cat').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-id');
                    try {
                        // Buscar el estado actual de la categoría
                        const resGet = await fetch(`${API_BASE}/categories/${id}`);
                        if (!resGet.ok) throw new Error('No se pudo obtener la categoría');
                        const cat = await resGet.json();
                        const endpoint = cat.isActive ? 'deactivate' : 'activate';
                        const res = await fetch(`${API_BASE}/categories/${id}/${endpoint}`, { method: 'PUT' });
                        if (!res.ok) throw new Error('No se pudo cambiar el estado');
                        await refrescarTodo();
                    } catch (err) {
                        await Swal.fire('Error', err.message, 'error');
                    }
                });
            });
        }

        // Lógica principal de filtros (asegura que categorias esté cargado antes de renderizar productos)
        async function aplicarFiltros() {
            let url = '';
            let productos = [];
            let total = 0;
            const filtroCategoria = document.getElementById('filtroCategoria');
            const filtroBusqueda = document.getElementById('filtroBusqueda');
            const filtroOrden = document.getElementById('filtroOrden');
            const filtroEstado = document.getElementById('filtroEstado');
            const categoria = filtroCategoria ? filtroCategoria.value : '';
            const busqueda = filtroBusqueda ? filtroBusqueda.value.trim() : '';
            const orden = filtroOrden ? filtroOrden.value : '';
            const estado = filtroEstado ? filtroEstado.value : 'todos';
            let paginaActual = window.paginaActual || 0;
            const tamanoPagina = 12;
            if (busqueda) {
                url = `${API_BASE}/products/search?q=${encodeURIComponent(busqueda)}`;
                const res = await fetch(url);
                productos = await res.json();
                total = productos.length;
            } else if (estado === 'inactivos') {
                url = `${API_BASE}/products/inactivos`;
                const res = await fetch(url);
                productos = await res.json();
                total = productos.length;
            } else if (estado === 'activos') {
                url = `${API_BASE}/products?`;
                if (categoria) url += `categoria=${categoria}&`;
                if (orden) url += `sort=${orden}&`;
                url += `page=${paginaActual}&size=${tamanoPagina}`;
                const res = await fetch(url);
                const data = await res.json();
                productos = data._embedded ? data._embedded.productoList : data;
                productos = productos.filter(p => p.isActive !== false);
                total = productos.length < tamanoPagina ? (paginaActual * tamanoPagina + productos.length) : (paginaActual + 2) * tamanoPagina;
            } else {
                // Mostrar todos (activos e inactivos)
                url = `${API_BASE}/products?`;
                if (categoria) url += `categoria=${categoria}&`;
                if (orden) url += `sort=${orden}&`;
                url += `page=${paginaActual}&size=${tamanoPagina}`;
                const res = await fetch(url);
                const data = await res.json();
                productos = data._embedded ? data._embedded.productoList : data;
                total = productos.length < tamanoPagina ? (paginaActual * tamanoPagina + productos.length) : (paginaActual + 2) * tamanoPagina;
            }
            renderProductos(productos);
            renderPaginacion(total, paginaActual, tamanoPagina);
        }

        // Paginación (sin cambios)
        function renderPaginacion(total, page, size) {
            const totalPages = Math.ceil(total / size);
            let html = '';
            if (totalPages > 1) {
                html += `<nav><ul class="pagination justify-content-center">`;
                for (let i = 0; i < totalPages; i++) {
                    html += `<li class="page-item${i === page ? ' active' : ''}"><a class="page-link" href="#" onclick="cambiarPagina(${i});return false;">${i + 1}</a></li>`;
                }
                html += `</ul></nav>`;
            }
            document.getElementById('paginacionProductos').innerHTML = html;
        }
        window.cambiarPagina = function(nuevaPag) {
            window.paginaActual = nuevaPag;
            aplicarFiltros();
        };

        // Botón de restablecer filtros
        document.getElementById('btnResetFiltros').addEventListener('click', function() {
            document.getElementById('filtrosForm').reset();
            window.paginaActual = 0;
            aplicarFiltros();
        });

        // Al cargar la página, cargar y renderizar categorías y productos
        document.addEventListener('DOMContentLoaded', () => {
            cargarCategoriasYRenderizar();
            aplicarFiltros();
        });

        // Manejar el submit de filtros
        const filtrosForm = document.getElementById('filtrosForm');
        if (filtrosForm) {
            filtrosForm.addEventListener('submit', function(e) {
                e.preventDefault();
                window.paginaActual = 0;
                aplicarFiltros();
            });
        }

        // Modal y formulario de categoría
        const modalCategoria = new bootstrap.Modal(document.getElementById('modalCategoria'));
        // Modificar el submit del formCategoria para soportar edición
        document.getElementById('formCategoria').addEventListener('submit', async function(e) {
            e.preventDefault();
            setCatMsg('', '');
            const nombre = document.getElementById('catName').value.trim();
            const desc = document.getElementById('catDesc').value.trim();
            const img = document.getElementById('catImg').value.trim();
            const editId = document.getElementById('formCategoria').getAttribute('data-edit-id');
            try {
                let res;
                if (editId) {
                    // Edición
                    res = await fetch(`${API_BASE}/categories/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: nombre, description: desc, imageUrl: img || null })
                    });
                } else {
                    // Creación
                    res = await fetch(`${API_BASE}/categories`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: nombre, description: desc, imageUrl: img || null })
                    });
                }
                if (!res.ok) throw new Error(editId ? 'Error al editar categoría' : 'Error al crear categoría');
                await refrescarTodo();
                await Swal.fire('¡Éxito!', editId ? 'Categoría editada exitosamente.' : 'Categoría creada exitosamente.', 'success');
                setTimeout(() => { modalCategoria.hide(); }, 1000);
            } catch (err) {
                await Swal.fire('Error', err.message, 'error');
            } finally {
                document.getElementById('formCategoria').removeAttribute('data-edit-id');
            }
        });
        // Al abrir el modal para crear, limpiar el atributo de edición
        document.getElementById('addCategoriaBtn').addEventListener('click', () => {
            document.getElementById('formCategoria').reset();
            setCatMsg('', '');
            document.getElementById('formCategoria').removeAttribute('data-edit-id');
            modalCategoria.show();
        });
        function setCatMsg(msg, type) {
            const el = document.getElementById('catMsg');
            if (!msg) { el.className = 'alert d-none'; el.textContent = ''; return; }
            el.className = 'alert alert-' + type; el.textContent = msg;
        }

        // Modal y formulario de producto
        const modalProducto = new bootstrap.Modal(document.getElementById('modalProducto'));
        function setProdMsg(msg, type) {
            const el = document.getElementById('prodMsg');
            if (!msg) { el.className = 'alert d-none'; el.textContent = ''; return; }
            el.className = 'alert alert-' + type; el.textContent = msg;
        }
        // Unificar carga de categorías para el dropdown del modal producto
        async function cargarCategoriasDropdown() {
            const res = await fetch(`${API_BASE}/categories`);
            let data = await res.json();
            if (data._embedded && data._embedded.categoriaList) {
                data = data._embedded.categoriaList;
            }
            const select = document.getElementById('prodCat');
            select.innerHTML = '';
            data.filter(cat => cat.isActive !== false).forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat.categoriaId;
                opt.textContent = cat.name;
                select.appendChild(opt);
            });
        }
        document.getElementById('formProducto').addEventListener('submit', async function(e) {
            e.preventDefault();
            setProdMsg('', '');
            const nombre = document.getElementById('prodName').value.trim();
            const desc = document.getElementById('prodDesc').value.trim();
            const brand = document.getElementById('prodBrand').value.trim();
            const price = parseInt(document.getElementById('prodPrice').value, 10);
            const catId = document.getElementById('prodCat').value;
            const img = document.getElementById('prodImg').value.trim();
            const editId = document.getElementById('formProducto').getAttribute('data-edit-id');
            try {
                let res;
                if (editId) {
                    res = await fetch(`${API_BASE}/products/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: nombre, description: desc, brand: brand, basePrice: price, imageUrl: img || null, categoria: { categoriaId: catId }, productId: editId })
                    });
                } else {
                    res = await fetch(`${API_BASE}/products`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: nombre, description: desc, brand: brand, basePrice: price, imageUrl: img || null, categoria: { categoriaId: catId } })
                    });
                }
                if (!res.ok) throw new Error(editId ? 'Error al editar producto' : 'Error al crear producto');
                await refrescarTodo();
                await Swal.fire('¡Éxito!', editId ? 'Producto editado exitosamente.' : 'Producto creado exitosamente.', 'success');
                setTimeout(() => { modalProducto.hide(); }, 1000);
            } catch (err) {
                await Swal.fire('Error', err.message, 'error');
            } finally {
                document.getElementById('formProducto').removeAttribute('data-edit-id');
            }
        });

        // Modal y formulario de carga batch
        const modalBatch = new bootstrap.Modal(document.getElementById('modalBatch'));
        function setBatchMsg(msg, type) {
            const el = document.getElementById('batchMsg');
            if (!msg) { el.className = 'alert d-none'; el.textContent = ''; return; }
            el.className = 'alert alert-' + type; el.textContent = msg;
        }
        document.getElementById('formBatch').addEventListener('submit', async function(e) {
            e.preventDefault();
            setBatchMsg('', '');
            let datos;
            try {
                datos = JSON.parse(document.getElementById('batchJson').value);
                if (!Array.isArray(datos)) throw new Error('El JSON debe ser un array');
            } catch (err) {
                await Swal.fire('Error', 'JSON inválido: ' + err.message, 'error');
                return;
            }
            try {
                const endpoint = `${API_BASE}/products/batch`;
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                if (!res.ok) throw new Error('Error al cargar datos batch');
                await refrescarTodo();
                await Swal.fire('¡Carga batch exitosa!', 'Los productos fueron cargados correctamente.', 'success');
                setTimeout(() => { modalBatch.hide(); }, 1200);
            } catch (err) {
                await Swal.fire('Error', err.message, 'error');
            }
        });

        // Asegurar apertura de modales de producto y batch
        document.getElementById('addProductoBtn').addEventListener('click', async () => {
            document.getElementById('formProducto').reset();
            setProdMsg('', '');
            document.getElementById('formProducto').removeAttribute('data-edit-id');
            await cargarCategoriasDropdown();
            modalProducto.show();
        });
        document.getElementById('batchBtn').addEventListener('click', () => {
            document.getElementById('formBatch').reset();
            setBatchMsg('', '');
            modalBatch.show();
        });

        // API Tester functionality
        const modalApiTester = new bootstrap.Modal(document.getElementById('modalApiTester'));
        
        document.getElementById('apiTesterBtn').addEventListener('click', () => {
            modalApiTester.show();
        });

        // Test Categories endpoint
        document.getElementById('testCategoriesBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('categoriesStatus');
            const responseEl = document.getElementById('categoriesResponse');
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Products endpoint
        document.getElementById('testProductsBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('productsStatus');
            const responseEl = document.getElementById('productsResponse');
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Count by Category endpoint
        document.getElementById('testCountBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('countStatus');
            const responseEl = document.getElementById('countResponse');
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products/count-by-categoria`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                // Formatear la respuesta para mejor legibilidad
                let formattedResponse = 'Formato: [categoriaId, cantidad]\n\n';
                if (Array.isArray(data)) {
                    data.forEach((item, index) => {
                        formattedResponse += `Categoría ${item[0]}: ${item[1]} productos\n`;
                    });
                }
                formattedResponse += '\nJSON Original:\n' + JSON.stringify(data, null, 2);
                
                responseEl.textContent = formattedResponse;
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Category by ID endpoint
        document.getElementById('testCategoryByIdBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('categoryByIdStatus');
            const responseEl = document.getElementById('categoryByIdResponse');
            const id = document.getElementById('categoryIdInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/categories/${id}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Category Search endpoint
        document.getElementById('testCategorySearchBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('categorySearchStatus');
            const responseEl = document.getElementById('categorySearchResponse');
            const query = document.getElementById('categorySearchInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/categories/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Category Exists endpoint
        document.getElementById('testCategoryExistsBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('categoryExistsStatus');
            const responseEl = document.getElementById('categoryExistsResponse');
            const name = document.getElementById('categoryExistsInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/categories/exists?name=${encodeURIComponent(name)}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Product by ID endpoint
        document.getElementById('testProductByIdBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('productByIdStatus');
            const responseEl = document.getElementById('productByIdResponse');
            const id = document.getElementById('productIdInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products/${id}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Product Search endpoint
        document.getElementById('testProductSearchBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('productSearchStatus');
            const responseEl = document.getElementById('productSearchResponse');
            const query = document.getElementById('productSearchInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Products Inactivos endpoint
        document.getElementById('testProductsInactivosBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('productsInactivosStatus');
            const responseEl = document.getElementById('productsInactivosResponse');
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products/inactivos`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });

        // Test Product Exists endpoint
        document.getElementById('testProductExistsBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('productExistsStatus');
            const responseEl = document.getElementById('productExistsResponse');
            const name = document.getElementById('productExistsInput').value;
            
            statusEl.className = 'badge bg-warning';
            statusEl.textContent = 'Procesando...';
            responseEl.textContent = 'Realizando petición...';
            
            try {
                const response = await fetch(`${API_BASE}/products/exists?name=${encodeURIComponent(name)}`);
                const data = await response.json();
                
                statusEl.className = response.ok ? 'badge bg-success' : 'badge bg-danger';
                statusEl.textContent = response.ok ? '200 OK' : `${response.status} Error`;
                
                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Error';
                responseEl.textContent = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html> 